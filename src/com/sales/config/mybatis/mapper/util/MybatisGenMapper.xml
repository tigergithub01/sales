<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sales.dao.util.MybatisGenMapper">

  <resultMap id="ColResultMap" type="com.sales.model.util.meta.MetaCol">
  	<result column="table_name" property="tableName" />
    <result column="column_name" property="columnName" />
    <result column="data_type" property="dataType" />
    <result column="column_comment" property="columnComment" />
    <result column="is_nullable" property="isNullable" />
    <result column="character_maximum_length" property="columnLength" />
    <result column="constraint_name" property="constraintName" />
    <result column="referenced_table_name" property="referencedTableName" />
  </resultMap>
  
  <resultMap id="FkResultMap" type="com.sales.model.util.meta.MetaFk">
    <result column="column_name" property="columnName" />
    <result column="constraint_name" property="constraintName" />
    <result column="referenced_table_name" property="referencedTableName" />
  </resultMap>
  
  <resultMap id="TblResultMap" type="com.sales.model.util.meta.MetaTbl">
    <result column="table_name" property="tableName" />
    <result column="table_comment" property="tableComment" />
  </resultMap>
  
  <select id="getTableList" parameterType="java.util.Map" resultMap="TblResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select table_name,table_comment from information_schema.tables 
    where table_type in ('VIEW','BASE TABLE') AND TABLE_NAME like CONCAT('%','${tableName}','%')
  </select>
  
  <select id="getTableInfo" parameterType="java.util.Map" resultMap="TblResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select TABLE_NAME,TABLE_COMMENT from information_schema.tables 
    where TABLE_NAME = #{tableName} AND table_type in ('VIEW','BASE TABLE')
  </select>
  
  <select id="getColumnList1" parameterType="java.util.Map" resultMap="ColResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select a.column_name,a.data_type,a.column_comment , is_nullable, character_maximum_length
	from information_schema.columns a
	where a.table_name = #{tableName} order by a.ordinal_position
  </select>
  
  <select id="getColumnList" parameterType="java.util.Map" resultMap="ColResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select col.table_name, col.column_name,col.data_type,col.column_comment, is_nullable, character_maximum_length ,fk.constraint_name,fk.REFERENCED_TABLE_NAME
	from information_schema.columns col left join 
	(
		select col_usage.COLUMN_NAME, ref.constraint_name,ref.REFERENCED_TABLE_NAME
		from information_schema.REFERENTIAL_CONSTRAINTS ref,information_schema.KEY_COLUMN_USAGE col_usage 
		where ref.table_name = #{tableName} and ref.constraint_name = col_usage.constraint_name
	) 
	fk on (col.column_name = fk.column_name)
	where col.table_name = #{tableName} order by col.ordinal_position
  </select>  
  
  <select id="getColumnFKList" parameterType="java.util.Map" resultMap="FkResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select b.column_name, a.constraint_name,a.referenced_table_name
	from information_schema.REFERENTIAL_CONSTRAINTS a,information_schema.KEY_COLUMN_USAGE b 
	where a.table_name = #{tableName} and a.constraint_name = b.constraint_name
  </select>
  
  <!-- not support more than one primary keys -->
  <select id="getTablePK" parameterType="java.util.Map" resultType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select column_name from information_schema.KEY_COLUMN_USAGE  
	where TABLE_NAME = #{tableName} and constraint_name ='PRIMARY'
  </select>
  
  <!-- not support more than one primary keys -->
  <select id="getReferencedTbls" parameterType="java.util.Map" resultType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select distinct a.referenced_table_name
	from information_schema.REFERENTIAL_CONSTRAINTS a,information_schema.KEY_COLUMN_USAGE b 
	where a.table_name = #{tableName} and a.constraint_name = b.constraint_name
  </select>
  
  <select id="getColCountInTable" parameterType="java.util.Map" resultType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(1)
	from information_schema.columns
	where table_name = #{tableName} and column_name=#{columnName}
  </select>
  
	
</mapper>